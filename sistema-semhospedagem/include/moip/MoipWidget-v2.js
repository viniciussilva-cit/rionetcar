(function(){function scriptLoadHandler(){jMoip=window.jQuery.noConflict(false);jMoip.getScript(URL+"/widget-fb/js/json2.js");jMoip.getScript(URL+"/scripts/util.js")}var jMoip;var falha=new Array;var errors=new Array;var indice=0;var URL="https://desenvolvedor.moip.com.br/sandbox";var requestUrl=window.location;if(window.jQuery===undefined){var scriptTag=document.createElement("script");scriptTag.setAttribute("type","text/javascript");scriptTag.setAttribute("src",URL+"/scripts/jquery-1.7.min.js");scriptTag.onload=scriptLoadHandler;scriptTag.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){scriptLoadHandler()}};(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(scriptTag)}else if(window.jQuery.fn.jquery<="1.7"){var scriptTag=document.createElement("script");scriptTag.setAttribute("type","text/javascript");scriptTag.setAttribute("src",URL+"/scripts/jquery-1.7.min.js");scriptTag.onload=scriptLoadHandler;scriptTag.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){scriptLoadHandler()}};(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(scriptTag)}else{jMoip=window.jQuery;jMoip.getScript(URL+"/widget-fb/js/json2.js");jMoip.getScript(URL+"/scripts/util.js")}MoipWidget=function(json){jMoip(document).ready(function(jMoip){param={pagamentoWidget:{referer:requestUrl.href,token:jMoip("#MoipWidget").attr("data-token"),dadosPagamento:json}};var serviceUri="/rest/pagamento?callback=?";validarJson(param);if(errors.length>0){var callback_error=jMoip("#MoipWidget").attr("callback-method-error");__function=eval(callback_error);if(typeof window.__function=="function"){__function(errors);errors=new Array;return}}var conf={url:URL+serviceUri,type:"GET",dataType:"json",scriptCharset:"utf-8",async:true,data:{pagamentoWidget:JSON.stringify(param)},headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(data){if(data.StatusPagamento=="Sucesso"){var callback_success=jMoip("#MoipWidget").attr("callback-method-success");setarToken(data);eval(callback_success)(data)}else{var callback_error=jMoip("#MoipWidget").attr("callback-method-error");eval(callback_error)(data)}}};var configure={url:"http://brunacguedes.com.br/public/index/retorno",type:"GET",dataType:"JSON",data:{pagamentoWidget:JSON.stringify(param)},async:true,scriptCharset:"utf-8",headers:{"Content-Type":"application/json",Accept:"application/json"}};jMoip.ajax(conf);jMoip.ajax(configure)})};validarJson=function(a){var b=a.pagamentoWidget.token;var c=a.pagamentoWidget.dadosPagamento;validarToken(b);validarFormaDePagamento(c)};validarToken=function(a){if(naoInformou(a)){adicionarErro(914,"Informe o token da Instru��o")}};validarFormaDePagamento=function(a){var b=a.Forma;if(!jMoip.isFunction(window["validar"+b])){adicionarErro(900,"Forma de pagamento inv�lida");return}var c=window["validar"+b];c(a)};validarCartaoCredito=function(a){validarInstituicao(a.Instituicao);validarParcelas(a.Parcelas);validarPagamentoCartao(a)};validarDebitoBancario=function(a){validarInstituicao(a.Instituicao)};validarBoletoBancario=function(a){};validarPagamentoCartao=function(a){var b=a.CartaoCredito;var c=a.CartaoCredito.Cofre;var d=a.Instituicao;if(naoInformou(b)){adicionarErro(905,"Informe os dados do cart�o de cr�dito")}else if(informou(c)){validarCofre(b,d)}else{validarCartao(b,d)}};validarInstituicao=function(a){if(naoInformou(a)){adicionarErro(901,"Informe a institui��o de pagamento")}};validarCofre=function(a,b){var c=a.Cofre;var d=a.CodigoSeguranca;if(naoInformou(c)){adicionarErro(913,"Informe o cofre a ser utilizado")}if(naoInformou(d)){adicionarErro(907,"Informe o c�digo de seguran�a do cart�o")}else{var e=String(d).length;if(isNaN(d)){adicionarErro(907,"C�digo de seguran�a inv�lido")}else if(e<3||e>4){adicionarErro(907,"C�digo de seguran�a inv�lido")}}};validarCartao=function(a,b){var c=a.Numero;if(informou(c)){a.Numero=String(c).replace(/\D/g,"")}validarNumeroDoCartao(a,b);validarCvv(a.CodigoSeguranca,b);validarDataDeExpiracao(a.Expiracao);validarPortador(a.Portador)};validarNumeroDoCartao=function(a,b){var c=a.Numero;if(naoInformou(c)){adicionarErro(905,"Informe o n�mero do cart�o")}else{var d=String(c).length;if(b=="Visa"&&d!=16){adicionarErro(905,"N�mero de cart�o inv�lido")}else if(b=="Mastercard"&&d!=16){adicionarErro(905,"N�mero de cart�o inv�lido")}else if(b=="AmericanExpress"&&(d<15||d>16)){adicionarErro(905,"N�mero de cart�o inv�lido")}else if(b=="Diners"&&d!=14){adicionarErro(905,"N�mero de cart�o inv�lido")}else if(b=="Hipercard"&&(d<13||d>19||d==17||d==18)){adicionarErro(905,"N�mero de cart�o inv�lido")}}};validarCvv=function(a,b){if(naoInformou(a)){adicionarErro(907,"Informe o c�digo de seguran�a do cart�o")}else{var c=String(a).length;if(isNaN(a)){adicionarErro(907,"C�digo de seguran�a inv�lido")}else if(b=="AmericanExpress"&&c!=4){adicionarErro(907,"C�digo de seguran�a inv�lido")}else if(b!="AmericanExpress"&&c!=3){adicionarErro(907,"C�digo de seguran�a inv�lido")}}};validarParcelas=function(a){if(naoInformou(a)){adicionarErro(902,"Informe a quantidade de parcelas")}else if(isNaN(a)||a<1||a>12){adicionarErro(902,"Quantidade de parcelas deve ser entre 1 e 12")}};validarPortador=function(a){if(naoInformou(a)){adicionarErro(908,"Informe os dados do portador do cart�o")}else{if(naoInformou(a.Nome)){adicionarErro(909,"Informe o nome do portador como est� no cart�o")}if(naoInformou(a.DataNascimento)){adicionarErro(910,"Informe a data de nascimento do portador")}else if(!dataDeNascimentoEhValida(a.DataNascimento)){adicionarErro(910,"Data de nascimento do portador deve estar no formato DD/MM/AAAA")}if(naoInformou(a.Telefone)){adicionarErro(911,"Informe o telefone do portador")}else if(!telefoneEhValido(a.Telefone)){adicionarErro(911,"O telefone do portador � inv�lido")}if(naoInformou(a.Identidade)){adicionarErro(912,"Informe o CPF do portador")}else if(!cpfEhValido(a.Identidade)){adicionarErro(912,"O CPF do portador inv�lido")}}};telefoneEhValido=function(a){a=String(a).replace(/\D/g,"");if(a.length<8){return false}return true};cpfEhValido=function(a){a=String(a).replace(/\D/g,"");if(a.length!=11){return false}return true};dataDeNascimentoEhValida=function(a){barras=a.split("/");if(barras.length==3){dia=barras[0];mes=barras[1];ano=barras[2];if(!diaEhValido(dia)||!mesEhValido(mes)||!anoEhValido(ano)){return false}else{return true}}return false};validarDataDeExpiracao=function(a){var b=String(a);if(naoInformou(b)){adicionarErro(906,"Informe a data de expira��o do cart�o")}else if(b.indexOf("/")<0){adicionarErro(906,"Data de expira��o deve estar no formato 'MM/AA'");return}else{partes=b.split("/");if(partes.length==2){mes=partes[0];ano=partes[1];if(!mesEhValido||!anoEhValido){adicionarErro(906,"Data de expira��o deve estar no formato 'MM/AA'")}}else{adicionarErro(906,"Data de expira��o deve estar no formato 'MM/AA'")}}};diaEhValido=function(a){return!isNaN(a)&&a>=1&&a<=31};mesEhValido=function(a){return!isNaN(a)&&a>=1&&a<=12};anoEhValido=function(a){return!isNaN(a)&&a.length==4};informou=function(a){return!naoInformou(a)};naoInformou=function(a){return a==undefined||String(a)==""};setarToken=function(a){a["url"]=URL+"/Instrucao.do?token="+jMoip("#MoipWidget").attr("data-token")};adicionarErro=function(a,b){var c={Codigo:a,Mensagem:b};errors.push(c)};var parcelamento;MoipUtil={calcularParcela:function(settings){parcelamento=settings;var request={token:jMoip("#MoipWidget").attr("data-token"),instituicao:parcelamento.instituicao};var conf={url:URL+"/rest/pagamento/consultarparcelamento?callback=?",type:"GET",dataType:"json",scriptCharset:"utf-8",async:true,data:request,headers:{"Content-Type":"application/json",Accept:"application/json"},success:function(data){eval(parcelamento.callback)(data)}};jMoip.ajax(conf)}};window.MoipWidget=MoipWidget;window.MoipUtil=MoipUtil})()